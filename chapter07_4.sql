-- JSON 데이터
-- JSON : JavaScript Object Notatioh 개방형 표준 데이터 포맷

USE sqldb;
SELECT JSON_OBJECT('name', name, 'height', height) AS 'JSON 값'
FROM usertbl
WHERE height >= 180;

SET @json='{ "usertbl" :
[
	{"name":"임재범","height": 182},
	{"name":"이승기","height": 182},
	{"name":"성시경","height": 186}
]
}';

SELECT JSON_VALID(@json) AS JSON_VALID;	-- 만족하면 1, 아니면 0 반환
SELECT JSON_SEARCH(@json, 'one', '성시경') AS JSON_SEARCH;
SELECT JSON_EXTRACT(@json, '$.usertbl[2].name') AS JSON_EXTRACT;
SELECT JSON_INSERT(@json, '$.usertbl[0].mDate', '2009-09-09') AS JSON_INSERT;
SELECT JSON_REPLACE(@json, '$.usertbl[0].name', '홍길동') AS JSON_REPLACE;
SELECT JSON_REMOVE(@json, '$.usertbl[0]') AS JSON_REMOVE;

-- 조인

USE sqldb;
SELECT *
	FROM buytbl
		INNER JOIN usertbl
			ON buytbl.userID = usertbl.userID
	WHERE buytbl.userID = 'JYP';
    
SELECT userID, name, prodName, addr, CONCAT(mobile1, mobil2) AS '연락처'	-- 어느 테이블인지 명시 (오류)
  FROM buytbl
	INNER JOIN usertbl
       ON buytbl.userId = usertbl.userD
ORDER BY num;

USE sqldb;
SELECT B.userID, U.name, B.prodName, U.addr, 	-- 테이블에 별칭 부여
	   CONCAT(U.mobile1, U.mobile2) AS '연락처'
  FROM buytbl B
	INNER JOIN usertbl U
    ON B.userID = U.userID
 WHERE B.userID = 'JYP'
 ORDER BY B.num;

SELECT B.userID, U.name, B.prodName, U.addr,
	   CONCAT(U.mobile1, U.mobile2) AS '연락처'
  FROM usertbl U
	INNER JOIN buytbl B 
    ON B.userID = U.userID
 ORDER BY U.userID;

-- ex) 쇼핑몰에서 한번이라도 구매한 기록이 있는 우수회원에게 감사의 안내문을 발송하자
SELECT DISTINCT U.userID, U.name, U.addr	-- 중복 결과 하나만 출력
  FROM usertbl U
 INNER JOIN buytbl B
    ON U.userID = B.userID
 ORDER BY U.userID;
 
 -- < 실습 4, 5, 6> --
 USE sqldb;
CREATE TABLE stdTbl
(stdName VARCHAR(10) NOT NULL PRIMARY KEY,
 addr	 CHAR(4) NOT NULL
);
CREATE TABLE clubtbl
(clubName VARCHAR(10) NOT NULL PRIMARY KEY,
 roomNo   CHAR(4) NOT NULL
);
CREATE TABLE stdclubtbl
(num int AUTO_INCREMENT NOT NULL PRIMARY KEY,
 stdName VARCHAR(10) NOT NULL,
 clubName VARCHAR(10) NOT NULL,
FOREIGN KEY(stdName) REFERENCES stdtbl(stdName),
FOREIGN KEY(clubName) REFERENCES clubtbl(clubName)
);
INSERT INTO stdtbl VALUES ('김범수', '경남'), ('성시경', '서울'), ('조용필', '경기'), ('은지원', '경북'), ('바비킴', '서울');
INSERT INTO clubtbl VALUES ('수영', '101호'), ('바둑', '102호'), ('축구', '103호'), ('봉사', '104호');
INSERT INTO stdclubtbl VALUES (NULL, '김범수', '바둑'), (NULL, '김범수', '축구'), (NULL, '조용필', '축구'), (NULL, '은지원', '축구'),
							  (NULL, '은지원', '봉사'), (NULL, '바비킴', '봉사');
                              
SELECT S.stdName, S.addr, C.clubName, C.roomNo
  FROM stdtbl S
 INNER JOIN stdClubtbl SC
    ON S.stdName = SC.stdName
 INNER JOIN clubtbl C
    ON SC.clubName = C.clubName
 ORDER BY S.stdName;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                